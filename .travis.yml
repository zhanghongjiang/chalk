sudo: false

# version automatically picked up from .ruby-version
language: ruby
cache: bundler

before_install:
  - gem update --system
  - gem install bundler jekyll

before_script:
  - chmod +x ./bin/setup
  - ./bin/setup
  - bundle exec jekyll build

script: bundle exec htmlproofer ./_site --only-4xx --allow-hash-href --assume-extension --check-opengraph --url-ignore "feed.xml,/facebook.com/"

after_success:
- chmod +x ./bin/automated
- ./bin/automated

env:
  global:
    - NOKOGIRI_USE_SYSTEM_LIBRARIES=true # speeds up installation of html-proofer
    - LC_ALL=en_US.UTF-8
    - JEKYLL_ENV=production
    - GITHUB_TOKEN: b353629ca3611848cf32740356af4be5ecb7c6c2
    - USERNAME: zhanghongjiang
    - EMAIL: mytiger@gmail.com

